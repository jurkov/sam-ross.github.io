{"version":3,"file":"ModelLoader.js","sources":["../src/ModelLoader.js"],"sourcesContent":["/**\r\n * @author Garrett Johnson / http://gkjohnson.github.io/\r\n * https://github.com/gkjohnson/threejs-model-loader\r\n */\r\nimport * as THREE from 'three';\r\n\r\nexport default\r\nclass ModelLoader {\r\n\r\n\tconstructor( manager ) {\r\n\r\n\t\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\t\tthis.cachedLoaders = {};\r\n\t\tthis.loaderClasses = THREE;\r\n\t\tthis.loaderMap = {\r\n\r\n\t\t\t'3mf': '3MFLoader',\r\n\t\t\t'amf': 'AMFLoader',\r\n\t\t\t'bvh': 'BVHLoader',\r\n\t\t\t'assimp': 'AssimpLoader',\r\n\t\t\t'babylon': 'BabylonLoader',\r\n\t\t\t'dae': 'ColladaLoader',\r\n\t\t\t'drc': 'DRACOLoader',\r\n\t\t\t'fbx': 'FBXLoader',\r\n\t\t\t'gcode': 'GCodeLoader',\r\n\t\t\t'gltf': 'GLTFLoader',\r\n\t\t\t'glb': 'GLTFLoader',\r\n\t\t\t'kmz': 'KMZLoader',\r\n\t\t\t'md2': 'MD2Loader',\r\n\t\t\t'mmd': 'MMDLoader',\r\n\t\t\t'obj': 'OBJLoader',\r\n\t\t\t'ply': 'PLYLoader',\r\n\t\t\t'pcd': 'PCDLoader',\r\n\t\t\t'prwm': 'PRWMLoader',\r\n\t\t\t'stl': 'STLLoader',\r\n\t\t\t'tds': 'TDSLoader',\r\n\t\t\t'vtk': 'VTKLoader',\r\n\t\t\t'vtp': 'VTKLoader',\r\n\t\t\t'wrl': 'VRMLLoader',\r\n\t\t\t'x': 'XLoader',\r\n\t\t\t'zae': 'ColladaArchiveLoader',\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/* Override-able Interface */\r\n\t// function that creates a loader instance and passes it back to\r\n\t// the `loaderCb`.\r\n\tgetLoader( loaderName, manager, loaderCb ) {\r\n\r\n\t\tloaderCb( new this.loaderClasses[ loaderName ]( manager ) );\r\n\r\n\t}\r\n\r\n\t/* Public Functions */\r\n\tload( url, onLoad, onProgress, onError, extOverride = null ) {\r\n\r\n\t\tonError = onError || ( e => console.error( e ) );\r\n\r\n\t\t// Get the extension associated the file so we can get the\r\n\t\t// appropriate loader\r\n\t\tvar extMatches = url.match( /\\.([^\\.\\/\\\\]+)$/ );\r\n\t\tvar urlext = extMatches ? extMatches[ 1 ] : null;\r\n\t\tvar ext = extOverride || urlext;\r\n\r\n\t\tif ( url == null ) {\r\n\r\n\t\t\tonError( new Error( 'Model Loader : No file extension found' ) );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis.extToLoader( ext, loader => {\r\n\r\n\t\t\t// TODO: set the cross origin etc information\r\n\t\t\tloader.load( url, res => {\r\n\r\n\t\t\t\tonLoad( this.formResult( res ) );\r\n\r\n\t\t\t}, onProgress, onError );\r\n\r\n\t\t}, onError );\r\n\r\n\t}\r\n\r\n\tparse( data, ext, onLoad, onError ) {\r\n\r\n\t\tonError = onError || ( e => console.error( e ) );\r\n\r\n\t\tthis.extToLoader( ext, this.manager, loader => {\r\n\r\n\t\t\tonLoad( this.formResult( loader.parse( data ) ) );\r\n\r\n\t\t}, onError );\r\n\r\n\t}\r\n\r\n\t/* Private Functions */\r\n\t// Forms the resultant object from a load to normalize the return format.\r\n\tformResult( res, extension ) {\r\n\r\n\t\tconst mat = new THREE.MeshBasicMaterial( { color: 0xffffff } );\r\n\t\tlet model = res.scene || res.object || res;\r\n\t\tmodel = model.isBufferGeometry || model.isGeometry ? new THREE.Mesh( model, mat ) : model;\r\n\r\n\t\treturn {\r\n\r\n\t\t\tmodel,\r\n\t\t\textension,\r\n\t\t\toriginalResult: res\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Creates a loader based on the provided extension. The loader is passed\r\n\t// into the `loaderCb` callback function\r\n\textToLoader( ext, loaderCb, onError ) {\r\n\r\n\t\t// Get the name of the loader we need\r\n\t\text = ext ? ext.toLowerCase() : null;\r\n\t\tvar loaderName = this.loaderMap[ ext ] || null;\r\n\t\tif ( loaderName == null ) {\r\n\r\n\t\t\tonError( new Error( `Model Loader : No loader specified for '${ ext }' extension` ) );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// If the loader isn't already cached the lets load it\r\n\t\tvar loader = this.cachedLoaders[ loaderName ] || null;\r\n\r\n\t\tif ( loader != null ) {\r\n\r\n\t\t\tloaderCb( loader );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.getLoader( loaderName, this.manager, loader => {\r\n\r\n\t\t\t\tthis.cachedLoaders[ loaderName ] = loader;\r\n\t\t\t\tloaderCb( loader );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n"],"names":["THREE.DefaultLoadingManager","THREE.MeshBasicMaterial","THREE.Mesh"],"mappings":"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"}